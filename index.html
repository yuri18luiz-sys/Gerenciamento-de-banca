<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GERENCIADOR DE BANCA OB</title>
    <style>
        /* URLs das Imagens (CORRIGIDO PARA ENDEREÇOS ESTÁVEIS) */
        :root {
            /* URL BASE DO SEU SITE HOSPEDADO */
            --base-url: "https://yuri18luiz-sys.github.io/Gerenciamento-de-banca/";

            /* URLs Estáveis (Usando a URL base do GitHub Pages) */
            --bg-image-url: url('https://yuri18luiz-sys.github.io/Gerenciamento-de-banca/fundo.png');
            --header-image-url: url('https://yuri18luiz-sys.github.io/Gerenciamento-de-banca/titulo.png');
            --bull-img-url: url('https://yuri18luiz-sys.github.io/Gerenciamento-de-banca/touro.png.jpg');
            --bear-img-url: url('https://yuri18luiz-sys.github.io/Gerenciamento-de-banca/urso.png.jpg');
            --normal-green: #28a745; 
        }

        /* TEMA ESCURO AVANÇADO E FUNDO TEMÁTICO */
        body { 
            font-family: 'Montserrat', sans-serif; 
            padding: 20px; 
            color: #E0E6F0; 
            line-height: 1.6;
            
            /* FUNDO DO SITE COM IMAGEM DE GRÁFICOS */
            background-image: var(--bg-image-url);
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-color: #0d1117; 
            
            /* Ajuste para garantir que o fundo seja sutil, mas visível */
            background-blend-mode: luminosity;
            opacity: 1;
        }

        .container { 
            max-width: 500px; 
            margin: 0 auto; 
            background: #161b22; 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.7); 
            border: 1px solid #30363d; 
        }
        
        /* CABEÇALHO COM IMAGEM DE FUNDO (titulo.png) */
        .header-area {
            position: relative;
            padding: 20px 0;
            margin-bottom: 20px;
            text-align: center;
            border-radius: 10px;
            overflow: hidden;
            /* Fundo de segurança e base */
            background-color: rgba(0, 0, 0, 0.5); 
        }
        .header-area::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: var(--header-image-url);
            background-size: cover; /* Ajusta a imagem para cobrir a área */
            background-repeat: no-repeat;
            background-position: center;
            opacity: 0.25; /* Opacidade ajustada */
            z-index: 1;
        }

        h1 { 
            position: relative;
            z-index: 2;
            color: #FFF; 
            margin-bottom: 5px; 
            font-size: 2em;
            text-shadow: 0 0 8px rgba(0, 0, 0, 0.8);
        }
        
        #personalizacao { 
            position: relative;
            z-index: 2;
            text-align: center; 
            font-size: 1.3em; 
            font-weight: bold; 
            text-transform: uppercase; 
            margin-bottom: 0; 
            color: #c9d1d9; 
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.6);
        } 
        
        /* Estilos gerais (inputs, botões, etc) */
        .campo { margin-bottom: 20px; }
        .campo label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: bold; 
            color: #8b949e; 
            font-size: 0.95em;
        }
        
        .campo input[type="number"] { 
            width: 100%; 
            padding: 14px; 
            box-sizing: border-box; 
            border: 1px solid #30363d; 
            border-radius: 8px; 
            background-color: #21262d; 
            color: #FFF; 
            font-size: 1.05em;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3); 
        }
        .campo input[type="number"]:focus {
            border-color: #58a6ff;
            outline: none;
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.3); 
        }

        button { 
            width: 100%; 
            padding: 14px; 
            box-sizing: border-box; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-weight: bold; 
            font-size: 1.1em;
            transition: all 0.2s ease-in-out; 
            margin-top: 10px; 
            display: flex; 
            justify-content: center;
            align-items: center;
        }
        button:hover:not(.disabled) {
            transform: translateY(-2px); 
            opacity: 0.9;
        }

        /* Cores dos botões */
        button { background-color: #58a6ff; color: white; } 
        .win { background-color: var(--normal-green); color: white; } 
        .loss { background-color: #D32F2F; color: white; } 
        .disabled { opacity: 0.4; cursor: not-allowed; transform: none; }
        .config-botoes button { background-color: #444c56; color: #FFF; } 
        .config-botoes button:hover:not(.disabled) { background-color: #5a626b; }
        .secao-meta button { background-color: #008cba; } 
        .secao-meta button:hover:not(.disabled) { background-color: #007bb5; }
        .secao-meta .config-botoes button { background-color: #ffc107; color: #333; } 
        .secao-meta .config-botoes button:hover:not(.disabled) { background-color: #e0a800; }
        
        /* Saída e Infos */
        #resultado-entrada { 
            font-size: 1.4em; 
            color: #FFF; 
            text-align: center; 
            padding: 20px; 
            border: 1px solid #444c56; 
            border-radius: 10px; 
            margin-top: 25px; 
            background-color: #21262d;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
        }
        #banca-info { 
            display: flex; 
            justify-content: space-between; 
            margin-bottom: 30px; 
            padding: 20px; 
            background-color: #1a1e24; 
            border-radius: 10px; 
            box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.5);
            border: 1px solid #30363d;
        }
        .banca-valor { 
            font-size: 1.3em; 
            font-weight: bold; 
            color: var(--normal-green); /* Aplicando verde normal */
        }
        .banca-campo label { color: #8b949e; margin-bottom: 5px; }


        /* Estilo Histórico */
        #estatisticas-historico { 
            display: flex; 
            justify-content: space-around; 
            margin-top: 20px; 
            padding: 15px; 
            background-color: #1a1e24; 
            border-radius: 10px; 
            box-shadow: inset 0 1px 4px rgba(0, 0, 0, 0.5);
            border: 1px solid #30363d;
        }
        #estatisticas-historico span { font-weight: bold; font-size: 1.1em; color: #c9d1d9; }
        #historico { margin-top: 40px; }
        #historico h3 { 
            margin-bottom: 20px; 
            color: #c9d1d9; 
            border-bottom: 2px solid #30363d; 
            padding-bottom: 8px; 
            font-size: 1.4em; 
            text-align: center;
        }
        #lista-historico { list-style: none; padding: 0; }
        #lista-historico li { 
            display: flex; 
            justify-content: space-between; 
            padding: 12px; 
            border-bottom: 1px dashed #30363d; 
            font-size: 0.95em;
        }
        #lista-historico li:last-child { border-bottom: none; } 

        .historico-win { color: var(--normal-green); font-weight: bold; } 
        .historico-loss { color: #FF5252; font-weight: bold; } 
        
        hr { 
            border: none; 
            border-top: 1px solid #30363d; 
            margin: 35px 0; 
            opacity: 0.6;
        }

        /* Estilos da nova seção */
        .secao-meta { border-top: 3px solid var(--normal-green); margin-top: 40px; padding-top: 20px; }
        .secao-meta h2 { color: var(--normal-green); text-align: center; margin-bottom: 25px; }
        #resultado-bingo { 
            border: 1px dashed var(--normal-green); 
            background-color: #21262d; 
            color: #E0E6F0; 
            padding: 18px; 
            border-radius: 10px; 
            font-size: 1.1em;
            line-height: 1.8;
        }
        #progresso-diario { margin-top: 25px; text-align: center; }
        #progresso-diario p { margin-bottom: 8px; font-size: 1.05em; }
        #bingo-lucro-dia { color: var(--normal-green); } 
        #bingo-meta-diaria { color: #ffc107; } 

        /* --- IMAGENS E ÍCONES REAIS --- */
        .img-icon-btn {
            width: 25px; 
            height: 25px;
            object-fit: cover; 
            border-radius: 50%; 
            margin-left: 10px;
        }
        .header-icons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 0 10px; 
            position: relative;
            z-index: 2;
        }
        .header-icons img {
            width: 70px; 
            height: 70px;
            object-fit: cover; 
            border-radius: 50%; 
            border: 2px solid; 
            opacity: 0.9;
        }
        .header-icons .touro-header {
            border-color: var(--normal-green); 
            filter: drop-shadow(0 0 8px rgba(0, 200, 83, 0.5));
        }
        .header-icons .urso-header {
            border-color: #D32F2F; 
            filter: drop-shadow(0 0 8px rgba(211, 47, 47, 0.5));
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header-area">
        <div class="header-icons">
            <img src="https://yuri18luiz-sys.github.io/Gerenciamento-de-banca/touro.png.jpg" class="touro-header">
            <span></span> 
            <img src="https://yuri18luiz-sys.github.io/Gerenciamento-de-banca/urso.png.jpg" class="urso-header">
        </div>
        <h1>GERENCIADOR DE BANCA</h1>
        <div id="personalizacao"></div> 
    </div>

    <div id="banca-info">
        <div class="banca-campo">
            <label>Banca Inicial:</label>
            <span id="banca-inicial" class="banca-valor">R$ 0,00</span>
        </div>
        <div class="banca-campo">
            <label>Banca Atual:</label>
            <span id="banca-atual" class="banca-valor">R$ 0,00</span>
        </div>
    </div>

    <div id="configuracoes">
        <div class="campo">
            <label for="input-banca-inicial">Definir Saldo Inicial:</label>
            <input type="number" id="input-banca-inicial" value="" step="0.01" placeholder="Ex: 100.00">
        </div>

        <div class="campo">
            <label for="meta-lucro">Porcentagem de Lucro (%):</label>
            <input type="number" id="meta-lucro" value="10" min="0.01" step="0.01" placeholder="Ex: 10">
        </div>

        <div class="campo">
            <label for="stop-loss-percent">Stop Loss (%):</label>
            <input type="number" id="stop-loss-percent" value="10" min="0.01" max="99" step="0.01" placeholder="Ex: 10">
        </div>
        
        <div class="campo">
            <label for="payout-percent">Payout da Plataforma (%):</label>
            <input type="number" id="payout-percent" value="85" min="0.01" max="99" step="0.01" placeholder="Ex: 90">
        </div>

        <div class="campo">
            <label for="num-entradas">Número de Entradas:</label>
            <input type="number" id="num-entradas" value="2" min="1" step="1" placeholder="Ex: 2">
        </div>

        <button onclick="calcularEntrada()">CALCULAR ENTRADA</button>
        <div id="resultado-entrada">Preencha os campos e clique em CALCULAR ENTRADA</div>
    </div>

    <hr>

    <div id="operacao-botoes" style="text-align: center; margin-top: 20px;">
        <button id="btn-nova-operacao" onclick="toggleResultadoBotoes(true)" style="background-color: #58a6ff; color: white; margin-bottom: 15px;" class="disabled" disabled>NOVA OPERAÇÃO</button>
        <div id="botoes-resultado" style="display: none;">
            <button class="win" onclick="registrarResultado('win')">
                WIN (Ganho) <img src="https://yuri18luiz-sys.github.io/Gerenciamento-de-banca/touro.png.jpg" class="img-icon-btn">
            </button>
            <button class="loss" onclick="registrarResultado('loss')">
                LOSS (Perda) <img src="https://yuri18luiz-sys.github.io/Gerenciamento-de-banca/urso.png.jpg" class="img-icon-btn">
            </button>
        </div>
    </div>

    <div id="historico">
        <h3>Estatísticas de Desempenho</h3>
        <div id="estatisticas-historico">
            <span>N° de WIN: <span id="count-wins" class="historico-win">0</span></span>
            <span>N° de LOSS: <span id="count-losses" class="historico-loss">0</span></span>
            <span>Total: <span id="count-total">0</span></span>
        </div>

        <h3>Últimas Operações</h3>
        <ul id="lista-historico">
            </ul>
        
        <div class="config-botoes">
            <button onclick="perguntarPersonalizacao()">EDITAR NOME</button>
            <button onclick="limparHistorico()" style="background-color: #6c757d; color: white;">Limpar Histórico e Resetar Banca</button>
        </div>
    </div>

    <div id="bingo-secao" class="secao-meta">
        <h2>🎯 BINGO DO MÊS / META AGRESSIVA</h2>

        <div class="campo">
            <label for="bingo-meta-total">Meta Total (R$):</label>
            <input type="number" id="bingo-meta-total" value="1000" step="0.01" placeholder="Ex: 1000.00">
        </div>
        
        <div class="campo">
            <label for="bingo-saldo-inicial">Seu Saldo Atual (R$):</label>
            <input type="number" id="bingo-saldo-inicial" value="10" step="0.01" placeholder="Ex: 10.00">
        </div>

        <div class="campo">
            <label for="bingo-num-dias">Número de Dias para a Meta:</label>
            <input type="number" id="bingo-num-dias" value="20" min="1" step="1" placeholder="Ex: 20">
        </div>

        <button onclick="calcularBingo()">CALCULAR PLANO DIÁRIO (JURO COMPOSTO)</button>
        
        <div id="resultado-bingo">
            Insira os valores e clique em CALCULAR PLANO DIÁRIO (JURO COMPOSTO).
        </div>

        <hr style="margin-top: 20px; border-style: dotted;">

        <div id="progresso-diario" style="display: none;">
            <h3>Progresso Diário</h3>
            <p>Seu Saldo Atual: <strong id="bingo-saldo-display" class="banca-valor">R$ 0,00</strong></p>
            <p>Lucro do Dia: <strong id="bingo-lucro-dia" style="color: var(--normal-green);">R$ 0,00</strong></p>
            <p>Meta de Lucro Diária: <strong id="bingo-meta-diaria" style="color: #ffc107;">R$ 0,00</strong></p>
            <p>WINS Faltando: <strong id="bingo-wins-restantes">0</strong></p>
            
            <div id="botoes-bingo" class="config-botoes">
                <button class="win" onclick="registrarBingo('win')">WIN</button>
                <button class="loss" onclick="registrarBingo('loss')">LOSS</button>
                <button onclick="resetarMetaDiaria()" style="background-color: #ffc107; color: #333;">Zerar Progresso do Dia</button>
            </div>
        </div>
    </div>
    </div>

<script>
    // VARIÁVEIS GLOBAIS
    let bancaInicial = 0;
    let bancaAtual = 0;
    let valorPorEntrada = 0;
    let bancaInicialFixada = false;
    let payoutDecimal = 0;
    let historicoOperacoes = []; 
    let nomeUsuario = "";
    let saldoMinimoStopLoss = 0; 

    // VARIÁVEIS DO BINGO
    let bingoMetaTotal = 0;
    let bingoSaldoAtual = 0;
    let bingoNumDias = 0;
    let bingoCrescimentoDiarioPercentual = 0; 
    let bingoLucroDoDia = 0;
    let bingoValorEntrada = 0; 
    let bingoMetaDiariaLucro = 0; 
    const BINGO_PAYOUT = 0.90; // Payout fixo para os cálculos do Bingo (90%)

    // --- FUNÇÕES DE ARMAZENAMENTO (LOCALSTORAGE) ---
    function salvarDados() {
        localStorage.setItem('bancaInicial', bancaInicial);
        localStorage.setItem('bancaAtual', bancaAtual);
        localStorage.setItem('bancaInicialFixada', bancaInicialFixada);
        localStorage.setItem('historicoOperacoes', JSON.stringify(historicoOperacoes));
        localStorage.setItem('nomeUsuario', nomeUsuario);
        localStorage.setItem('saldoMinimoStopLoss', saldoMinimoStopLoss); 
        
        // Salvar dados do Bingo
        localStorage.setItem('bingoMetaTotal', bingoMetaTotal);
        localStorage.setItem('bingoSaldoAtual', bingoSaldoAtual);
        localStorage.setItem('bingoNumDias', bingoNumDias);
        localStorage.setItem('bingoLucroDoDia', bingoLucroDoDia);
        localStorage.setItem('bingoCrescimentoDiarioPercentual', bingoCrescimentoDiarioPercentual);
    }

    function carregarDados() {
        const savedBancaInicial = localStorage.getItem('bancaInicial');
        const savedBancaAtual = localStorage.getItem('bancaAtual');
        const savedFixada = localStorage.getItem('bancaInicialFixada');
        const savedHistorico = localStorage.getItem('historicoOperacoes');
        const savedNome = localStorage.getItem('nomeUsuario');
        const savedSaldoMinimo = localStorage.getItem('saldoMinimoStopLoss');
        
        // Carregar dados do Bingo
        const savedBingoMetaTotal = localStorage.getItem('bingoMetaTotal');
        const savedBingoSaldoAtual = localStorage.getItem('bingoSaldoAtual');
        const savedBingoNumDias = localStorage.getItem('bingoNumDias');
        const savedBingoLucroDoDia = localStorage.getItem('bingoLucroDoDia');
        const savedBingoCrescimentoDiarioPercentual = localStorage.getItem('bingoCrescimentoDiarioPercentual');

        // Lógica de personalização
        if (savedNome) {
            nomeUsuario = savedNome;
        } else {
            perguntarPersonalizacao();
            return; 
        }

        // Lógica da Banca Principal
        if (savedBancaInicial !== null) {
            bancaInicial = parseFloat(savedBancaInicial);
            bancaAtual = parseFloat(savedBancaAtual);
            bancaInicialFixada = (savedFixada === 'true');
        } else {
             bancaAtual = 0;
             bancaInicial = 0;
        }

        if (savedSaldoMinimo !== null) {
            saldoMinimoStopLoss = parseFloat(savedSaldoMinimo);
        }

        if (savedHistorico) {
            historicoOperacoes = JSON.parse(savedHistorico);
        }
        
        // Lógica de desabilitar o input se a banca já estiver fixada (e não for zero)
        const inputField = document.getElementById('input-banca-inicial');
        
        if (bancaInicialFixada && bancaAtual > 0) {
            inputField.value = bancaAtual.toFixed(2);
            inputField.disabled = true;
            inputField.style.backgroundColor = '#21262d'; 
            inputField.style.color = '#8b949e'; 
        } else {
            // Se não fixou ou está zerada, o campo deve estar livre para edição
            inputField.disabled = false;
            inputField.style.backgroundColor = '#21262d'; 
            inputField.style.color = '#FFF'; 
            inputField.value = ""; // Garante que o campo esteja vazio ou use o placeholder para digitação
        }
        
        // Carregar dados do Bingo
        if (savedBingoMetaTotal) {
            bingoMetaTotal = parseFloat(savedBingoMetaTotal);
            bingoSaldoAtual = parseFloat(savedBingoSaldoAtual);
            bingoNumDias = parseInt(savedBingoNumDias);
            bingoLucroDoDia = parseFloat(savedBingoLucroDoDia);
            bingoCrescimentoDiarioPercentual = parseFloat(savedBingoCrescimentoDiarioPercentual);

            document.getElementById('bingo-meta-total').value = bingoMetaTotal.toFixed(2);
            document.getElementById('bingo-saldo-inicial').value = bingoSaldoAtual.toFixed(2);
            document.getElementById('bingo-num-dias').value = bingoNumDias;
            
            if (bingoMetaTotal > 0 && bingoNumDias > 0 && bingoSaldoAtual > 0) {
                calcularBingo(true); 
            }
        }

        // Verifica o Stop Loss ao carregar para desabilitar o botão se necessário
        if (saldoMinimoStopLoss > 0 && bancaAtual <= saldoMinimoStopLoss) {
             document.getElementById('resultado-entrada').innerHTML = `
                <strong style="color: red; font-size: 1.5em;">⛔ STOP LOSS ATINGIDO! ⛔</strong>
                <br>
                Prejuízo de R$ ${(bancaInicial - saldoMinimoStopLoss).toFixed(2).replace('.', ',')} atingido.
            `;
            document.getElementById('btn-nova-operacao').disabled = true;
            document.getElementById('btn-nova-operacao').classList.add('disabled');
        }
    }
    
    // --- FUNÇÃO DE PERSONALIZAÇÃO ---
    function perguntarPersonalizacao() {
        const nome = prompt("Digite seu Nome e Sobrenome:");
        if (nome && nome.trim() !== "") {
            nomeUsuario = nome.trim();
        } else {
            if (!nomeUsuario) nomeUsuario = "USUÁRIO"; 
        }
        salvarDados(); 
        atualizarDisplay(); 
    }

    // --- FUNÇÕES DE DISPLAY E INICIALIZAÇÃO ---
    function atualizarDisplay() {
        document.getElementById('banca-inicial').innerText = `R$ ${(bancaInicial || 0).toFixed(2).replace('.', ',')}`;
        document.getElementById('banca-atual').innerText = `R$ ${(bancaAtual || 0).toFixed(2).replace('.', ',')}`;
        
        const elementoPersonalizacao = document.getElementById('personalizacao');
        elementoPersonalizacao.innerText = nomeUsuario; 

        renderizarHistorico();
        atualizarDisplayBingo();
    }

    function lerBancaInicialInput() {
        const inputField = document.getElementById('input-banca-inicial');
        const inputBanca = parseFloat(inputField.value);
        return isNaN(inputBanca) ? 0 : inputBanca;
    }

    function renderizarHistorico() {
        const lista = document.getElementById('lista-historico');
        lista.innerHTML = '';
        
        let countWins = 0;
        let countLosses = 0;

        historicoOperacoes.forEach(op => {
            if (op.resultado === 'WIN') {
                countWins++;
            } else {
                countLosses++;
            }
        });

        document.getElementById('count-wins').innerText = countWins;
        document.getElementById('count-losses').innerText = countLosses;
        document.getElementById('count-total').innerText = countWins + countLosses;
        
        const ultimasOperacoes = historicoOperacoes.slice(-10).reverse(); 

        ultimasOperacoes.forEach(op => {
            const li = document.createElement('li');
            const classe = op.resultado === 'WIN' ? 'historico-win' : 'historico-loss';
            const data = new Date(op.timestamp).toLocaleTimeString('pt-BR');

            li.innerHTML = `
                <span>${data} - ${op.resultado}</span>
                <span class="${classe}">P&L: R$ ${op.pnl.toFixed(2).replace('.', ',')}</span>
            `;
            lista.appendChild(li);
        });
    }

    function limparHistorico() {
        if (confirm("Tem certeza que deseja limpar o histórico e resetar a banca para R$ 0,00?")) {
            localStorage.clear();
            window.location.reload(); 
        }
    }

    // --- LÓGICA DO GERENCIADOR (Cálculo e Operação) ---
    function calcularEntrada() {
        const inputInicial = document.getElementById('input-banca-inicial');
        const metaLucroPercentual = parseFloat(document.getElementById('meta-lucro').value) / 100;
        const stopLossPercent = parseFloat(document.getElementById('stop-loss-percent').value); // NOVO: Campo Stop Loss
        const payoutPercent = parseFloat(document.getElementById('payout-percent').value);
        const numEntradas = parseInt(document.getElementById('num-entradas').value);
        
        payoutDecimal = payoutPercent / 100;

        const novoSaldo = lerBancaInicialInput();
        
        if (!bancaInicialFixada) {
            if (novoSaldo <= 0) {
                document.getElementById('resultado-entrada').innerText = "Erro: Insira um Saldo Inicial válido.";
                return;
            }
            bancaInicial = novoSaldo;
            bancaInicialFixada = true;
            inputInicial.disabled = true; 
            inputInicial.style.backgroundColor = '#21262d'; 
            inputInicial.style.color = '#8b949e';
        }

        bancaAtual = novoSaldo; 
        const bancaBaseCalculo = bancaAtual; // O saldo atual é a base do cálculo do SL.

        if (bancaBaseCalculo <= 0 || metaLucroPercentual <= 0 || numEntradas < 1 || isNaN(metaLucroPercentual) || isNaN(numEntradas) || payoutPercent <= 0 || isNaN(payoutPercent) || isNaN(stopLossPercent) || stopLossPercent <= 0) {
            document.getElementById('resultado-entrada').innerText = "Erro: Preencha todos os campos (Banca, Meta, Payout, Entradas E Stop Loss) corretamente.";
            toggleResultadoBotoes(false);
            return;
        }

        // --- CÁLCULO E FIXAÇÃO DO STOP LOSS ---
        const perdaMaximaR$ = bancaBaseCalculo * (stopLossPercent / 100);
        saldoMinimoStopLoss = bancaBaseCalculo - perdaMaximaR$;

        // --- CÁLCULO DE ENTRADA NORMAL ---
        const lucroRealDesejado = bancaBaseCalculo * metaLucroPercentual;
        const valorTotalInvestimento = lucroRealDesejado / payoutDecimal;
        valorPorEntrada = valorTotalInvestimento / numEntradas;

        document.getElementById('resultado-entrada').innerHTML = `
            Valor da entrada: <strong>R$ ${valorPorEntrada.toFixed(2).replace('.', ',')}</strong>
            <br>
            Limite de Stop Loss: <strong>R$ ${perdaMaximaR$?.toFixed(2)?.replace('.', ',')}</strong> (Banca Mínima: R$ ${saldoMinimoStopLoss.toFixed(2).replace('.', ',')})
        `;

        document.getElementById('btn-nova-operacao').disabled = false;
        document.getElementById('btn-nova-operacao').classList.remove('disabled');
        toggleResultadoBotoes(false);
        atualizarDisplay();
        salvarDados(); 
    }

    function registrarResultado(resultado) {
        if (valorPorEntrada <= 0 || !bancaInicialFixada) return;
        if (saldoMinimoStopLoss > 0 && bancaAtual <= saldoMinimoStopLoss) return; 

        let PnL = 0;
        const valorApostado = valorPorEntrada;
        
        if (resultado === 'win') {
            PnL = valorApostado * payoutDecimal; 
        } else {
            PnL = -valorApostado;
        }

        bancaAtual += PnL;

        historicoOperacoes.push({
            timestamp: new Date().getTime(),
            resultado: resultado.toUpperCase(),
            valor: valorApostado,
            pnl: PnL
        });

        // --- VERIFICAR STOP LOSS APÓS O RESULTADO ---
        if (saldoMinimoStopLoss > 0 && bancaAtual <= saldoMinimoStopLoss) {
            document.getElementById('btn-nova-operacao').disabled = true;
            document.getElementById('btn-nova-operacao').classList.add('disabled');
            
            document.getElementById('resultado-entrada').innerHTML = `
                <strong style="color: #FF5252; font-size: 1.5em;">⛔ STOP LOSS ATINGIDO! PARE DE OPERAR. ⛔</strong>
                <br>
                O seu limite de perda foi alcançado. Saldo Atual: R$ ${bancaAtual.toFixed(2).replace('.', ',')}.
            `;
            
            toggleResultadoBotoes(false);
            valorPorEntrada = 0; 
            
        } else {
            document.getElementById('resultado-entrada').innerHTML = `
                ${resultado.toUpperCase()}! PnL: R$ ${PnL.toFixed(2).replace('.', ',')}.
                <br>Novo Saldo: R$ ${bancaAtual.toFixed(2).replace('.', ',')}.
                <br>Recalcule a entrada para operar novamente.
            `;
        }
        
        document.getElementById('input-banca-inicial').value = bancaAtual.toFixed(2);
        atualizarDisplay();
        salvarDados();

        if (saldoMinimoStopLoss === 0 || bancaAtual > saldoMinimoStopLoss) {
             document.getElementById('btn-nova-operacao').disabled = true;
             document.getElementById('btn-nova-operacao').classList.add('disabled');
             valorPorEntrada = 0;
        }

        toggleResultadoBotoes(false);

    }

    function toggleResultadoBotoes(show) {
        const botoesResultado = document.getElementById('botoes-resultado');
        const btnNovaOperacao = document.getElementById('btn-nova-operacao');

        if (show && valorPorEntrada > 0) {
            botoesResultado.style.display = 'block';
            btnNova Operacao.style.display = 'none';
        } else {
            botoesResultado.style.display = 'none';
            btnNovaOperacao.style.display = 'block';
        }
    }


    // --- BINGO DO MÊS / METAS AGRESSIVAS (JURO COMPOSTO) ---
    
    function atualizarDisplayBingo() {
        document.getElementById('bingo-saldo-display').innerText = `R$ ${bingoSaldoAtual.toFixed(2).replace('.', ',')}`;
        
        if (bingoCrescimentoDiarioPercentual > 0) {
            document.getElementById('progresso-diario').style.display = 'block';

            bingoMetaDiariaLucro = bingoSaldoAtual * (bingoCrescimentoDiarioPercentual - 1);
            
            const investimentoNecessario = bingoMetaDiariaLucro / BINGO_PAYOUT;
            bingoValorEntrada = investimentoNecessario;

            const lucroPorWin = bingoValorEntrada * BINGO_PAYOUT;
            const winsFaltando = Math.ceil((bingoMetaDiariaLucro - bingoLucroDoDia) / lucroPorWin);
            
            document.getElementById('bingo-lucro-dia').innerText = `R$ ${bingoLucroDoDia.toFixed(2).replace('.', ',')}`;
            document.getElementById('bingo-meta-diaria').innerText = `R$ ${bingoMetaDiariaLucro.toFixed(2).replace('.', ',')}`;
            document.getElementById('bingo-wins-restantes').innerText = Math.max(0, winsFaltando);

            if (bingoLucroDoDia >= bingoMetaDiariaLucro) {
                document.getElementById('bingo-lucro-dia').style.color = 'var(--normal-green)'; // Verde
                document.getElementById('bingo-wins-restantes').innerText = 0;
            } else if (bingoSaldoAtual <= 0) {
                 document.getElementById('bingo-saldo-display').style.color = '#FF5252'; // Vermelho
            } else {
                document.getElementById('bingo-lucro-dia').style.color = '#ffc107'; // Amarelo para lucro não atingido
                document.getElementById('bingo-saldo-display').style.color = 'var(--normal-green)'; // Saldo atual verde
            }

            if (bingoSaldoAtual < bingoValorEntrada && bingoSaldoAtual > 0) {
                 document.getElementById('resultado-bingo').innerHTML += `<br><span style="color:#FF5252; font-size: 0.9em;">AVISO: O saldo atual (R$ ${bingoSaldoAtual.toFixed(2).replace('.', ',')}) é **menor** que a entrada sugerida (R$ ${bingoValorEntrada.toFixed(2).replace('.', ',')})</span>`;
            } else if (bingoSaldoAtual <= 0) {
                 document.getElementById('resultado-bingo').innerHTML += `<br><span style="color:#FF5252; font-size: 0.9em;">ATENÇÃO: Banca zerada. Adicione saldo para continuar.</span>`;
            }

        } else {
            document.getElementById('progresso-diario').style.display = 'none';
        }
    }


    function calcularBingo(silencioso = false) {
        const metaTotal = parseFloat(document.getElementById('bingo-meta-total').value);
        const saldoAtual = parseFloat(document.getElementById('bingo-saldo-inicial').value);
        const numDias = parseInt(document.getElementById('bingo-num-dias').value);

        if (isNaN(metaTotal) || isNaN(saldoAtual) || isNaN(numDias) || metaTotal <= saldoAtual || numDias <= 0 || saldoAtual <= 0) {
            document.getElementById('resultado-bingo').innerText = "Erro: Preencha os campos corretamente. A Meta deve ser maior que o Saldo (e o Saldo deve ser maior que zero) e o N° de Dias deve ser maior que zero.";
            document.getElementById('progresso-diario').style.display = 'none';
            return;
        }

        const fatorCrescimento = Math.pow(metaTotal / saldoAtual, 1 / numDias);

        bingoMetaTotal = metaTotal;
        bingoSaldoAtual = saldoAtual;
        bingoNumDias = numDias;
        bingoCrescimentoDiarioPercentual = fatorCrescimento;
        
        const metaDiariaLucroR$ = (bingoSaldoAtual * fatorCrescimento) - bingoSaldoAtual;
        const investimentoNecessario = metaDiariaLucroR$ / BINGO_PAYOUT;

        bingoMetaDiariaLucro = metaDiariaLucroR$;
        bingoValorEntrada = investimentoNecessario; 

        document.getElementById('resultado-bingo').innerHTML = `
            Crescimento Diário Necessário: <strong>${((fatorCrescimento - 1) * 100).toFixed(2).replace('.', ',')}%</strong>
            <br>
            Meta de Lucro Diária (Hoje): <strong>R$ ${metaDiariaLucroR$.toFixed(2).replace('.', ',')}</strong>
            <br>
            Valor da Entrada Sugerida (Investimento): <strong>R$ ${investimentoNecessario.toFixed(2).replace('.', ',')}</strong>
            <br>
            Lucro por WIN: <strong>R$ ${(investimentoNecessario * BINGO_PAYOUT).toFixed(2).replace('.', ',')}</strong>
            <br>
            WINS (Lucros) Necessários por Dia: <strong>${Math.ceil(metaDiariaLucroR$ / (investimentoNecessario * BINGO_PAYOUT))}</strong>
        `;
        
        salvarDados();
        atualizarDisplayBingo();
        
        if (!silencioso) {
             alert(`Plano Calculado! Você precisa de ${(((fatorCrescimento - 1) * 100).toFixed(2).replace('.', ','))}% de crescimento diário.`);
        }
    }

    function registrarBingo(resultado) {
        if (bingoCrescimentoDiarioPercentual <= 0 || bingoSaldoAtual <= 0) {
            alert("Erro: Calcule o plano diário e/ou certifique-se de que o Saldo Atual seja maior que zero.");
            return;
        }

        let PnL = 0;
        
        if (resultado === 'win') {
            PnL = bingoValorEntrada * BINGO_PAYOUT; 
        } else {
            PnL = -bingoValorEntrada; 
        }

        bingoLucroDoDia += PnL;
        bingoSaldoAtual += PnL;

        document.getElementById('bingo-saldo-inicial').value = bingoSaldoAtual.toFixed(2);

        salvarDados();
        atualizarDisplayBingo();
        
        if (bingoSaldoAtual <= 0) {
            alert("ATENÇÃO: Sua banca está zerada ou negativa. É impossível atingir a meta agressiva sem adicionar mais saldo.");
        }
        
    }

    function resetarMetaDiaria() {
        bingoLucroDoDia = 0;
        salvarDados();
        atualizarDisplayBingo();
        alert("Progresso do dia zerado! Comece novamente.");
    }

    // Inicialização ao carregar a página
    window.onload = function() {
        carregarDados(); 
        atualizarDisplay();
        toggleResultadoBotoes(false);
    }
</script>

</body>
</html>
